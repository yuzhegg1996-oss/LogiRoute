# 基于 WebSocket 的即时通讯软件设计 与实现

学 院:信息科学与工程学院

专业班级:软件工程 1801 班

姓 名:柯泽正

学 号:20181107014

指导教师:董红斌 教授 高巍 助教

2022 年 5 月

# 基于WebSocket的即时通讯软件设计与 实现

# **Design and implementation of WebSocket-based instant messaging software**

# 摘要

随着信息时代移动互联网的高速发展,即时通讯成为人们不可或缺的日常生活 联系方式。但是人们已经不再满足传统的即时通讯工具,提出了更多的需求。传统 的即时通讯方案中大部分采用的是基于 Ajax 的轮询技术,也就是每隔一段时间就向 服务器进行一次网络请求以便获取最新的消息。因为此技术是基于 HTTP 的实时 Web 方案,所以对于信息频繁更新或者实时性很高的应用来说,此方案并不完美,而且 会消耗大量的服务器带宽资源。如今 WebSocket 协议已经广泛普及了,它是一种与 HTTP 协议不同的协议,WebSocket 使用客户端和服务器之间的数据交换变得更加间 的,允许服务端主动向客户端进行推送数据。在 WebSocket 协议中,浏览器和服务 器只需要完成一次握手,两者之间就可以创建持久性的连接,并进行双向数据传输。

本文旨在设计实现一个简单实用的基于 WebSocket 的即时通讯软件,能够帮助 人们随时随地进行沟通。此软件整体是采用的 JavaScript 语言编写,前端方面是采用 了 React 框架来设计实现 UI 界面和一些交互逻辑等,后端则是采用的 Node.js 框架 Express。这些框架都极大的提升了开发者的工作效率,能够让开发者在短时间内完 成一个系统的设计与实现。本软件主要有用户登录模块、好友管理模块、消息模块 和群组模块几个核心模块,每个模块之间相互配合让用户能完成各种操作。

关键词:即时通讯 WebSocket 群组通讯 WebRTC

# **Abstract**

With the rapid development of mobile Internet in the information age, instant messaging has become an indispensable way of contacting people in their daily lives. But people are no longer satisfied with the traditional instant messaging tools and have raised more demands. Most of the traditional instant messaging solutions use Ajax-based polling technology, which means that every once in a while a web request is made to the server to get the latest message. Since this technology is a real-time HTTP-based Web solution, it is not perfect for applications with frequent information updates or high real-time performance, and it consumes a lot of server bandwidth resources. Nowadays, WebSocket protocol has become widely popular, and it is a different protocol from HTTP protocol. WebSocket uses data exchange between client and server to become more interconnected, allowing the server to actively push data to the client. In WebSocket protocol, the browser and the server only need to complete one handshake to create a persistent connection between them and transfer data in both directions.

The purpose of this paper is to design and implement a simple and practical WebSocket-based instant messaging system that can help people communicate anytime and anywhere. The system is written in JavaScript, the front-end uses the React framework to design the UI interface and interaction logic, and the back-end uses the Node.js framework Express, which greatly improves the developer's work efficiency and allows the developer to complete the design and implementation of a system in a short period of time. The system mainly has several core modules, including user login module, friend management module, message module and group module, and each module cooperates with each other so that users can complete various operations.

**Key words:** Instant Messaging WebSocket Group Communication WebRTC

# 目 录

| 摘    | 要                      | I   |
|------|------------------------|-----|
| Ab   | stract                 | .II |
| 绪    | 论                      | . 1 |
| 1    | 可行性分析                  | . 3 |
| 1. 1 | L 技术可行性                | . 3 |
| 1. 2 | 2 经济可行性                | . 3 |
| 1. 3 | 3 社会可行性                | . 3 |
| 1. 4 | 4 开发技术和工具介绍            | . 3 |
| 1. 4 | 4.1 React 框架           | . 3 |
| 1. 4 | 4.2 Socket. IO 库       | . 4 |
| 1. 4 | 4.3 MondoDB 数据库        | . 4 |
| 1. 4 | 4.4 Visual Studio Code | . 4 |
| 1. 4 | 4.5 WebRTC 技术          | . 4 |
| 1. 4 | 4.6 WebSocket 技术       | . 5 |
| 2    | 需求分析                   | . 6 |
| 2. ] | 设计目的                   | . 6 |
| 2. 2 | 2 功能需求                 | . 6 |
| 2. 2 | 2.1 登录模块功能需求           | . 6 |
| 2. 2 | 2.2 好友管理模块功能需求         | . 7 |
| 2. 2 | 2.3 消息管理模块功能需求         | . 8 |
| 2. 2 | 2.4 音视频模块功能需求          | . 9 |
| 2. 2 | 2.5 群组管理模块功能需求         | 10  |
| 2. 3 | 3 环境需求                 | 10  |
| 3    | 软件总体设计与实现              | 11  |
| 3. ] | 软件概述                   | 11  |
| 3. 2 | 2 软件各模块设计              | 11  |

| 3. 2. 1 | 登录模块      | 11 |
|---------|-----------|----|
| 3. 2. 2 | 好友管理模块    | 15 |
| 3. 2. 3 | 消息管理模块    | 18 |
| 4 系统    | ē测试       | 23 |
| 4.1 系   | 统测试目的     | 23 |
| 4.2 模   | 其块功能测试    | 23 |
| 4. 2. 1 | 登录模块测试    | 23 |
| 4. 2. 2 | 好友模块测试    | 24 |
| 4. 2. 3 | 消息模块测试    | 24 |
| 4.3 测   | 试结果分析     | 25 |
| 5 研究    | E成果与社会的关系 | 26 |
| 结 论     |           | 27 |
| 致 谢     |           | 28 |
| 参考文庫    | <b></b>   | 29 |

# 绪论

#### (1)研究背景

随着互联网信息时代移动互联网的高速发展,智能终端进入了千家万户。手机电 话、短信,邮件无疑是人与人之间日常沟通的常用方式,通过电话,或者短信你可 以随时随地与人交流沟通分享生活的方方面面。据统计,在 10 年前(2012 年),75% 的美国青少年在日常沟通中使用短信,而只有 22% 的人使用桌面即时通讯聊天软 件。但是随着互联网的普及,相对于传统的电话,邮件等通信方式来说,即时通讯 不仅节省费用,而且效率更高。根据最新即时通讯统计数据显示,WhatsApp(美国 的一款即时通讯软件)在全球拥有 20 亿用户,Facebook Messenger 为 13 亿,中国 的微信以 12 亿用户量紧随其后。

#### (2)研究意义

即时通讯(Instant Messaging)是基于互联网的实时通讯软件,支持两人或者 多人在各类通讯终端上使用网络进行信息传递、语音视频通话、收发图片文件等。 在当今时代移动互联网的高度信息化、智能终端的快速普及下,各类即时通讯产品 已经成为人们生活的必备品,同时在各高校教学、管理、服务、联络中,即时通讯 也承担着不可替代的角色。本文研究的基于 WebSocket 的即时通讯软件设计与实现 能够实现人与人之间跨时空交流,突破空间上的限制,通过人与人的交流构建多样 的社会关系。

随着 Web 相关技术不断向前发展,人们更倾向于这种开发快速,效率高的 Web 技术, 特别是 JavaScript(Web 技术的核心)在社区的贡献下繁荣发展,有越来越多的信 息通讯平台使用 Web 技术作为系统的核心。基于 Web 的产品同时轻量级而且更新迭 代快,对于用户的各种需求能够很快地反映到实际应用当中。同时,Web 技术也凭借 着不断迭代更新的生命力受到越来越多的用户喜欢。而 WebSocket 技术则将即时通 讯带到一个新的赛道,让即时通讯更加稳定,快速。

#### (3)国内外研究现状

不管在国内还是国外,许多互联网公司都会投入一定精力去开发技术通讯软件, 他们把即时通讯同自己的其他类型产品进行捆绑。由于技术的发展和市场的不断扩 大,即时通讯发展迅速,功能也越来越多样化,同时,国外的技术也不断影响着国

内市场,各类通讯软件也跟上了国际化的脚步。

即时通讯软件已经和人们的生活紧密联系。在中国,QQ、微信、钉钉、飞书占据 了大部分的国内市场;而在国外,MSN、WhatsApp 等也很受用户的喜欢。虽然中国的 即时通讯软件众多,但是用户量最多的依然是 QQ 和微信,其功能完备,操作丰富, 被广大用户所使用。根据国际即时通讯软件的统计数据,国内的互联网用户呈上升 趋势,使用即时通讯的网民也越来越多,因此。Web 即时通讯软件的开发对于提升网 站用户的活跃度、网站的互动性有着重大的意义。

国内也有很多即时通讯方面的研究,淘宝在买家与买家进行沟通时使用的就是他们 开发的即时通讯服务;而 Web QQ 则作为很多应用的登录平台被腾讯广泛使用在各行 各业。对于一些商家和企业来说,即时通讯与自身平台的相互配合能够更好帮助他 们发展。

#### (4)主要研究内容

本课题主要研究的是基于 WebSocket 的即时通讯软件,与传统的即时通讯软件不 同,不用下载客户端,直接登录网站即可聊天通讯。软件包含用户登录模块、好友 管理模块、消息管理模块、群组模块、音视频通讯模块等。整个软件的各个环节介 绍如下:

第一部分:可行性分析,从技术经济社会三个角度分析系统实施的可行性,同时 介绍软件会使用到的各类开发工具和技术。

第二部分:需求分析,分析软件的各种功能需求,同时对软件的各个子模块进行 了较为详细的说明。

第三部分:软件总体设计与实现,比较详细的介绍了本即时通讯软件几个模块的 设计与实现方式。

第四部分:系统测试,针对软件完成的结果进行测试,对系统进行调试和完善。 第五部分:研究成果与社会的关系,针对本即时通讯软件的用户和对当前环境所 起到的作用。

第六部分:总结,对软件完成的整个过程进行一个总结。

最后,本文的结尾发表了本人的致谢。

# 1 可行性分析

对于一个项目来说,首先需要进行可行性分析,对该系统的完成可行性进行一个 分析判断,需要使用何种技术,哪些条件是必须的,需要花费的精力和时间又是多 少。一般情况下我们会从技术可行性、经济可行性以及社会可行性来分别进行可行 性分析。

#### 1.1 技术可行性

对于此次项目的开发,必要条件不是很高,主要是使用 JavaScript 编程语言来 开发一款 B/S 架构的软件,一般来说,它可以运行在主流系统浏览器当中,而开发 工具则可以选择市面上的主流开发工具 vscode,同时项目使用的前端框架也是开源 的,因此在技术上本项目是可行的。

#### 1.2 经济可行性

本软件使用的开发工具和技术基本都是开源免费的,没有什么成本。同时,我也 有充足的时间来学习相关技术和工具的使用,对于其中存在的问题也可以通过网上 搜索资料,咨询老师同学等方式来解决。因此开发此软件需要花费的时间、金钱和 精力的成本十分之低,基本没有什么花费。

#### 1.3 社会可行性

此次开发的软件,面向广大网络用户,人们可以使用此软件进行即时通讯社交, 进行信息传递、收发图片文件等等。同时此软件也可作为各高校、企业内部教学、 管理、服务和联络的工具。针对当前疫情,很多地区限制出现,而本软件能够让人 们跨越时间空间进行交流,满足了广大用户的社交需求。

#### 1.4 开发技术和工具介绍

此系统是基于 B/S 架构的,前端使用的 React 框架,后端使用 Express 框架,数 据库上采用的是 MongoDB 数据库,同时还使用一些组件库来简化前端开发。开发工 具上则是使用开源的 vscode 文本编辑器。

#### 1.4.1 React 框架

React 是一个用于构建用户界面的 JavaScript 库。在以往开发界面都是使用 HTML,而 React 则使用 JSX 来描述用户界面的试图。React 使用声明式编写 UI,可以 让你的代码更加可靠,且方便调试。React 的核心之一就是组件化,应用会被拆分成 一个个小组件,开发应用只需要把这个组件合理的堆砌在一起。React 除了开发客户 端应用外,服务端的 SSR 渲染也是有所涉及,同时 React Native 还能够开发安卓和 IOS 应用,覆盖面不可谓不广。React 将许多渲染工作进行抽象化,使您可以专注于 UI 设计。

#### 1.4.2 Socket.IO 库

Socket.IO 是一个面向实时 web 应用的 JavaScript 库。它使得服务器和客户端 之间实时双向通信成为可能。它有两个部分:在浏览器中运行的客户端库,和一个 面向 Node.js 的服务端库。Socket.IO 主要使用 WebSocket 协议,当浏览器不支持 WebSocket 时它会自动回退到 HTTP 轮询模式,它可以被用为 WebSocket 的包装库, 同时还提供了许多其他功能,比如广播至多个套接字,存储与不同用户客户有关的 数据,和异步 IO 操作。

#### 1.4.3 MongoDB 数据库

MongoDB 是一个基于分布式文件存储的数据库,由 C++语言编写。旨在为 Web 应 用提供可扩展的高性能数据存储解决方案。MongoDB 是一个介于关系数据库和非关系 数据库之间的产品,是非关系数据库当中功能最丰富,最像关系数据库的。

#### 1.4.4 Visual Studio Code

Visual Studio Code 简称 vscode,是一款由微软开发且跨平台的免费开源代码 编辑器。该软件支持语法高亮、代码自动补全、代码重构功能,并且内置了命令行 工具和 Git 版本控制系统,同时插件市场还有大量插件可供使用,配合相关插件能 够极大地提供开发效率。

#### 1.4.5 WebRTC 技术

WebRTC(Web Real-Time Communications)技术是一项实时通讯技术,它允许网 络应用或者站点,在不借助中间媒介的情况下,建立浏览器之间点对点的连接,实 现视频流和音频流或者其他任意数据的传输。WebRTC 包含的这些标准使用用户在无 需安装任何插件或者第三方软件的情况下,创建点对点的数据分享和电话会议成为 可能。

#### 1.4.6 WebSocket 协议

WebSocket 协议是建立在 TCP 协议之上,因此服务器端的实现相对比较容易。而 且 WebSocket 协议与 HTTP 协议有着良好的兼容性,在握手阶段也采用 HTTP 协议, 所以不容易在握手时被屏蔽。同时 WebSocket 协议的数据格式较为轻量,在数据传 输时性能开销小,通信高效,使用 WebSocket 协议来开发即时通讯软件十分适合。

# 2 需求分析

### 2.1 设计目的

本课题主要是研究基于 WebSocket 的即时通讯软件的设计与实现,旨在通过此软 件能够方便人们的网络交流。相对于传统的电话,邮件等通信方式来说,即时通信 不仅节省费用,而且效率更高。在当今时代移动互联网的高度信息化、智能终端的 快速普及下,各类即时通讯产品已经成为人们生活的必备品。本文研究的基于 WebSocket 的即时通讯软件能够实现人与人之间跨时空交流,突破空间上的限制,通 过人与人的交流构建多样化的社会关系。

### 2.2 功能需求

本软件根据功能需求分析,用户能够进行注册登录等对自己账号进行相关操作; 用户也可以对自己的好友进行添加和删除;用户可以选择与好友或群组间的消息发 送类型;用户还能添加和删除群组,以上功能大致可以整理为四个模块。

- (1)登录模块。主要包括用户注册、用户登录、用户注销功能。
- (2)好友管理模块。主要包括用户查询(通过特定信息)、添加好友、删除好 友功能。
- (3)消息管理模块。主要包括用户传输文本消息、用户传输图片消息、用户传 输文件消息功能。
- (4)群组管理模块。主要包括群组查询(通过特定信息)、添加群组、删除群 组功能。

#### 2.2.1 登录模块功能需求

登录模块主要完成用户的注册功能、用户的登录以及设置用户的个人信息等,其 实现的主要功能包括:

- (1)注册用户,用户进入系统首先需要一个账号,在注册界面注册完成自己的 信息后便会跳转至登录页,注册时必须使用未存在的用户名。
- (2)登录用户,用户登录系统时输入用户和密码即可,只有当用户名和密码都 与数据库中已存在的账号信息一致时才会登录成功,否则登录失败。
  - (3)设置用户信息,用户登录后可以设置个人的基本信息,包括昵称、性别、

手机、个人简介等等相关信息。

登录模块用例图如图 2-1 所示。

![](_page_12_Picture_2.jpeg)

图 2-1 登录模块用例图

#### 2.2.2 好友管理模块功能需求

好友管理模块是即时通讯聊天中最基础的模块之一,没有好友就无法进行即时通 讯交流。其主要的功能包括:

- (1)添加好友,用户可以根据搜索好友的用户或 ID 进行添加,添加成功后,选 择通讯列表里的好友就可以与添加的好友进行即时聊天通讯。
- (2)获取好友的状态,通过好友的在线状态可以判断好友是否在线,用户可以 手动选择自己的在线状态吗,离线时状态自动改变方便用户之间进行聊天,当好友 离线时,好友是无法即时回复的,即时通讯的基础是建立在双方用户都在线的。
- (3)删除好友,用户可以在好友列表中删除好友,删除好友后无法再和好友聊 天,除非再次添加该好友,删除后好友会从好友列表移除。

好友管理模块用例图如图 2-2 所示。

![](_page_13_Picture_0.jpeg)

图 2-2 好友管理模块用例图

#### 2.2.3 消息管理模块功能需求

消息管理模块是最核心的模块,用户与好友之间的即时通讯就是依赖着各种类型 的消息。其主要的功能包括:

- (1)发送文本消息,用户直接向好友发送文字,不包含其他非文本内容。
- (2)发送图片消息,用户发送图片消息给好友,用户收到后便会开始下载图片 内容,然后在好友侧加载出来。

消息管理模块用例图如图 2-3 所示。

![](_page_13_Picture_7.jpeg)

图 2-3 消息管理模块用例图

#### 2.2.4 音视频模块功能需求

音视频模块主要负责用户和好友之间的语音通话和视频通话,主要是通过声音和 视频画面来进行沟通交流。由于基础的即时通讯聊天已经远远不能满足用户的需求 了,有时候用户与好友之间需要语音通话或者视频通话来进行即时通讯聊天,这样 相比传统的文字图片更加直观。

- (1)语音通话聊天,用户与好友进行语音聊天,用户发出语音通话邀请后,好 友可以接受或者拒绝,接收后双方就可以正式开始语音通话,当聊天结束后,用户 和好友均可以选择取消来结束通话。
- (2)视频通话聊天,用户与好友进行视频聊天,用户发出视频通话邀请后,好 a 对方的摄像头画面(需要开启摄像头功能)。当聊天结束后,用户和好友均可以选 择取消来结束通话。

对于模块用例图如图 2-4 所示。

![](_page_14_Figure_5.jpeg)

图 2-4 音视频模块用例图

#### 2.2.5 群组管理模块功能需求

群组管理模块主要实现了多个用户或好友之间可以建立群组,更加方便地使用多 个好友参与进来,共同进行即时通讯的功能。

- (1)搜索群组,可以根据群组的 ID 或者群组的名字来进行搜索,当找到搜索的 群组时,可以选择加入群组中进行多人聊天。
- (2)创建群组,用户可以按照自己的需求新建一个群组,同时可以设置群组的 名字等群组信息。
- (3)退出群组,当用户不再需要群组的时候,可以选择退出群组,退出群组后 无法继续多人聊天,除非重新加入该群组。

群组管理模块用例图如图 2-5 所示。

![](_page_15_Picture_6.jpeg)

图 2-5 群组管理模块用例图

#### 2.3 环境需求

对于本软件的整个开发运行环境来说,只需要有一个浏览器和一个 vscode 开发 编辑器即可,同时也可以下载 Node.js 和 npm 包管理工具来使用我们需要的 JavaScript 的第三方包来加速开发。后端则是运行再 Node.js 中,本质上也是 JavaScript,Node.js 其实就是浏览器的 V8 引擎抽离出来并添加一些 API 组成的, 所以 Node.js 就好比一个小型浏览器,因此可以在服务端运行 JavaScript。

# 3 软件总体设计与实现

### 3.1 软件概述

本软件是基于 B/S 架构的即时通讯服务,相比于传统的 C/S 架构的聊天软件,轻 量简洁,不需要下载客户端,只需要登录网站,注册自己的账号就可以在浏览器中 使用最基本的即时通讯服务,同时也有语音通话和视频通话功能,也可以传输文字 图片等文件,而群组功能则方便多个用户朋友之间的相互联系。由于互联网的飞速 发展,计算机技术的不断迭代更新,基于 Web 的软件层出不穷,百花齐放,而我们 则享受的互联网带来便利实现这随时随地的沟通与交流。

本软件的总体设计目标是实现一个简单实用,方便快捷,而且不臃肿的一个即时 通讯软件,不仅可以进行基本的文字,图片,表情即时聊天,而且还可以进行语音 视频通话。

#### 3.2 软件各模块设计

根据不同的需求设计了几个不同的模块,模块之间相互作用,共同组成了此软件。 用户可以选择不同的模块来使用不同的功能。用户首先必须要在登录模块进行用户 注册,然后才可以登录即时通讯软件,使用其各种功能;之后就可以添加好友,发 送文字、图片、表情信息进行沟通;当好友之间有共同话题时还可以创建一个新的 群组,将不同好友拉入群组中,享受多人的即时通讯聊天。通过这几个不同模块的 设计,来各自完成各自的功能。这就是软件的模块化,每个模块专司其职,发挥着 自己的作用。

#### 3.2.1 登录模块

在登录模块中,排在最前的功能的就是注册、登录。用户注册了账号才能进行后 续的种种操作。

注册用户,用户注册是登录本系统的首要步骤,为了保证用户的安全,用户注册 时输入的密码会被加密保存至数据库,注册时如果用户名已存在则会有相应提示用 来提醒用户注册的用户名。注册用户的主要实现过程如下:

- (1) 用户输入用户名。
- (2) 如果用户名不存在则继续往后执行,否则要求重新输入用户名。

- (3) 用户输入密码,密码需遵守预定规则(规定字符内)。
- (4) 如果密码符合要求点击注册按钮后,系统内部调用注册函数进行注册用户账 号。
  - (5) 系统会将用户的账号与密码(密文)保存至数据库。
  - (6) 注册账号成功。

用户注册界面图如图 3-1 所示。

![](_page_17_Picture_5.jpeg)

图 3-1 用户注册界面图

登录用户,当用户注册成功后,就可以进行登录,登录时系统会将用户输入的信 息同数据库中的信息进行对比,如果比对成功则登录成功,否则提升用户账户不存 在或密码错误。用户登录的主要实现过程如下:

- (1) 用户输入用户名和密码。
- (2) 输入符合要求后点击登录按钮,系统内容调用登录函数进行登录。
- (3) 系统将用户输入的信息同数据库对比。
- (4) 当比对成功时,登录成功,否则弹出对应提示,重新开始登录流程。

用户登录界面图如图 3-2 所示。

![](_page_18_Picture_1.jpeg)

图 3-2 用户登录界面图

有关登录模块比较核心的代码如下:

```
// 登录
```

```
const handleLogin = async(userInfo: LoginParams) = >{
 try {
 const res = await login(userInfo)
 // 登录成功
 if (res.data ? .accountstatus === 1) {
 setUser(res.data) showModal() message.success('登录成功', 2)
 }
 // 用户名或密码错误
 if (res.data === '') {
 message.warn('用户名或密码错误', 2)
 }
```

```
 } catch(error) {
 console.error(error)
 }
}
// 注册
const handleRegister = async({
 username,
 password
}: RegisterParams) = >{
 const userInfo = {
 username,
 password
 }
 try {
 const res = await register(userInfo) if (res.data ? .code === 2004) {
 // 注册失败,用户名已存在
 message.warn('注册失败,用户名已存在', 2)
 }
 if (res.data ? .code === 2005) {
 setModalTitle('登录') message.success('注册成功', 2)
 }
 } catch(error) {
 console.error(error)
 }
}
```

上述代码块主要是判断用户再登录注册时,判断对应后端响应的请求码是否正 确,对应的状态码标志着不同的登录状态。登录时,返回的状态不正确就会弹出提 示框,告诉用户账号或密码错误。而在注册时如果返回状态码不对则是提示用户该 用户名已存在,请重新注册。

#### 3.2.2 好友管理模块

好友管理模块主要是用户对好友各种操作,搜索好友,添加好友,删除好友。添 加好友,用户登录系统成功后,可以按账号搜索好友并添加。其主要实现过程如下:

- (1) 用户登录成功进入主界面。
- (2) 输入已存在的好友账号。
- (3) 判断好友是否已经添加。
- (4) 当未添加时好友就会收到好友邀请,接收即可成为好友,并将对方添加至好 友列表。

用户发送好友申请后,好友方会显示一个用户申请,相关信息如图 3-3 所示。

![](_page_20_Figure_8.jpeg)

图 3-3 添加好友申请界面图

删除好友功能相对简单,在好友列表选择好友后选择删除好友即可,删除好友界 面图如图 3-4 所示。

![](_page_21_Picture_0.jpeg)

| 地区   | 湖北-武汉       | > |
|------|-------------|---|
| 备注   | Mr.wang     | > |
| 昵称   | 小王          | > |
| 手机号  | 18888888888 | > |
| 个性签名 | 过好每一天       | > |
|      |             |   |
|      | 发送消息        |   |
|      | 移除好友        |   |

图 3-4 删除好友界面图

添加好友和移除好友的核心代码如下所示:

```
async function handleDeleteFriend() {
    const isSuccess = await deleteFriend(_id);
    if (isSuccess) {
    action.removeLinkman(friend._id);
    if (currentLinkman._id === friend._id) {
       // 将对应 id 的好友从聊天列表里移除
    Actions.popTo('_chatlist');
    } else {
    Actions.pop();
```

```
 }
    }
   }
   Async function handleAddFriend() {
    const newLinkman = await addFriend(_id);
    const friendId = getFriendId(_id, self);
    if (newLinkman) {
    if (friend) {
      // 如果是未添加过的好友 则通过此好友 id 进行添加
    action.updateFriendProperty(friend._id, 'type', 'friend');
    const messages = await getLinkmanHistoryMessages(friend._id, 
friend.messages.length, );
    action.addLinkmanHistoryMessages(friend._id, messages);
    } else {
    action.addLinkman({...newLinkman,
    _id: friendId,
    name: username,
    type: 'friend',
    unread: 0,
    messages: [],
    from: self,
    to: {
    _id,
    avatar,
    username,
    },
    });
```

```
 const messages = await getLinkmanHistoryMessages(friendId, 0);
 action.addLinkmanHistoryMessages(friendId, messages);
 }
 action.setFocus(friendId);
 if (currentLinkman._id === friend ? ._id) {
 Actions.pop();
 } else {
 Actions.popTo('_chatlist');
 Actions.push('chat', {
 title: newLinkman.username
 });
 }
 }
}
```

#### 3.2.3 消息管理模块

消息管理模块最核心的功能就是收发消息,选择某一个好友后即可开始聊天,相 关聊天界面如图 3-5 所示。

![](_page_24_Picture_0.jpeg)

图 3-5 聊天界面图

除了文字信息外,还有表情信息可以发送,表情组如图 3-6 所示。

![](_page_24_Picture_3.jpeg)

图 3-6 表情消息图

在消息模块中,最核心的部分就是基于 WebSocket 的全双工协议进行通讯,在这 里我使用的 Socket.IO 库,它不仅封装了 WebSocket 协议,而且在不支持 WebSocket 协议的浏览器上会自动回退到 HTTP 轮询,同时为了防止通讯在连接时终,Socket.IO 会每隔一段时间进行通讯检测,这就是心跳检测。

有关消息通讯部分的代码如下:

```
$(function() {
 const url = 'http://127.0.0.1:3000'let _username = null let _$inputname = $('#name') let 
_$chatinput = $('#chatinput')
 let socket = io.connect(url)
 const sendMessage = () = >{
 /**
 * 得到输入框的聊天信息,如果不为空,就触发 sendMessage
 * 将信息和用户名发送过去
 */
 let _message = _$chatinput.val()
 if (_message) {
 socket.emit('sendMessage', {
 username: _username,
 message: _message
 })
 }
 }
 const showMessage = (data) = >{
 // 先判断这个消息是不是自己发出的,然后再以不同的样式显示
 if (data.username === _username) {
 $('#content').append(` < p style = 'background: lightskyblue' > <span > $ {
```

```
 data.username
 }: </span> ${data.message}</p > `)
 } else {
 $('#content').append(` < p style = 'background: lightpink' > <span > $ {
 data.username
 }: </span> ${data.message}</p > `)
 }
 }
 // 聊天事件
 _$chatinput.on('keyup',
 function(event) {
 if (event.keyCode === 13) {
 sendMessage() _$chatinput.val('')
 }
 })
 // socket.io 部分逻辑
 socket.on('loginSuccess', (data) = >{
 if (data.username === _username) {
 beginChat(data)
 } else {
 alert('用户名不匹配,请重试')
 }
 })
 socket.on('receiveMessage', (data) = >{
 showMessage(data)
 })
})
```

当客户端发送消息时,服务端就能监听到发送消息事件,此时服务器会将监听到 的信息进行暂时存储,当系统触发了发送消息事件成功的条件后,服务端会之前临 时存储的信息传输给所有客户端。

因为每个用户登录成功后都会有一个唯一的 ID,作为每一次通讯的唯一凭证。 在进行私聊的时候,客户端会注册一个接收信息的消息事件,而后发送消息成功后 便会被服务端捕捉到,此时如果不做任何的处理,那消息就会被发送给所有人。这 不是我们想要的,所以当发送信息时必须要传入要发送信息的 id,服务端会根据这个 id 找到对应的消息,利用这个 socket 触发对应的聊天事件,这样发送的消息只会被 指定好友接收到。

而群聊则是当用户创建或者加入一个群组之后,服务器端会创建一个房间,而这 个房间的名字就是群组的名字,通常也会作为 socket 的名字,使其唯一。加入后, 每次在群里发消息的时候,对消息进行广播,对应的客户端接收广播消息即可。

# 4 系统测试

### 4.1 系统测试目的

系统测试(System Testing)是对整个系统进行测试,将硬件、软件、操作人员 看做一个整体,检验它是否有不合符系统要求的地方。系统测试是所有软件系统开 发必不可少的一个环节,系统从开发到上线使用,这其中要经历多次的修改迭代, 而由于开发人员不可能保证代码不会出错,因此做出来的软件不可能是完美无缺的, 有时候还会出现开发人员无法预料的问题。只有经过系统测试后,才能将软件正式 投入使用当中。

### 4.2 模块功能测试

#### 4.2.1 登录模块测试

测试登录模块,以登录功能为例,主要考虑两种情况下系统的运行状况,一个是 输入正确的账号密码,另一个是输入错误的账号密码,测试表如表 4-1 所示。

| 测试编号 | TS001                           |
|------|---------------------------------|
| 测试时间 | 2022<br>年<br>05<br>月<br>18<br>日 |
| 测试目的 | 测试用户的系统登录功能在各个情况下是否能够正          |
|      | 常运行                             |
| 测试步骤 | 1 输入不存在的用户名或者错误的密码              |
|      | 2 输入正确账号和密码                     |
| 预测结果 | 1 登陆界面提示账户或者密码错误                |
|      | 2 用户正常登录进入系统                    |
| 实际结果 | 1 登录失败,提示提示账户或者密码错误             |
|      | 2 登陆成功                          |

表 4-1 登录功能测试表

经过测试,这两者情况下测试的预期结果于实际结果一致,测试通过,系统此功 能模块能够正常运行。

#### 4.2.2 好友模块测试

测试好友模块,以搜索好友并添加好友为例,在用户进入主页面后,搜索好友并 添加好友,相关测试表如表 4-2 所示。

表 4-2 好友模块功能测试表

| 测试编号 | TS002                           |
|------|---------------------------------|
| 测试时间 | 2022<br>年<br>05<br>月<br>18<br>日 |
| 测试目的 | 测试用户能否搜索并添加指定好友                 |
| 测试步骤 | 1 输入不存在的用户                      |
|      | 2 搜索存在的用户,并确认添加                 |
| 预测结果 | 1 界面显示不存在此用户                    |
|      | 2 界面显示添加此用户成功                   |
| 实际结果 | 1 搜索后显示没有此用户                    |
|      | 2 界面显示添加该用户成功                   |

经过测试,当搜索存在的账号时,用户能够成功搜索并可以添加好友。

#### 4.2.3 消息模块测试

测试消息模块,主要是测试用户向好友发送消息,好友是否能够正常接收消息。 其测试表如表 4-3 所示。

表 4-3 消息模块功能测试表

| 测试编号 | TS003                              |
|------|------------------------------------|
| 测试时间 | 2022<br>年<br>05<br>月<br>18<br>日    |
| 测试目的 | 测试用户能否正常向好友发送消息,好友能否正常接            |
|      | 收消息                                |
| 测试步骤 | 1 用户<br>A<br>向用户<br>B<br>发送消息      |
|      | 2 用户<br>B<br>向用户<br>A<br>发送消息      |
| 预测结果 | 1 用户<br>A<br>成功发送出消息               |
|      | 2 用户<br>A<br>成功接收到用户<br>B<br>发来的消息 |

| 实际结果 | 1 用户<br>B<br>界面显示用户<br>A<br>发来的消息 |
|------|-----------------------------------|
|      | 2 用户<br>A<br>界面显示用户<br>B<br>发来的消息 |

经过测试,系统的发送与接收消息功能正常。

#### 4.3 测试结果分析

在对系统进行测试时,确实发现了一些小问题,在 UI 方面有些地方会显示异常, 由于设备之间的分辨率不同,显示可能会存在缩放问题。同时移动端未进行屏幕适 配,所以有些界面在移动端上显示异常。但是总的来说,此系统的逻辑大部分都正 常运作,没有出现太大的问题,因此本次系统测试相对成功。

# 5 研究成果与社会的关系

这些年,随着计算机互联网技术的不断发展,人们对于 Web 即时通讯的需求也越 来越迫切,实时通信也成为了当下互联网 Web 技术的一个重要研究方向。虽然当前互 联网市场上已经存在了很多即时通讯应用,但是他们大多需要下载客户端到本地, 并且经常性更新。这种仅使用于电脑和手机上的软件应用已经远远不能满足市场的 多样化需求了,每当使用的电脑或智能设备上没有对应的即时通讯客户端,就必须 重新下载,而且当客户端出现新的功能、新的版本时,也必须更新客户端,这样十 分不便。而基于 WebSocket 的即时通讯软件,只需要一个浏览器,登录对应通讯系 统的网站就能开始即时通讯,在享受基础即时通讯聊天的同时,还能进行音视频的 通话,更加方便地进行好友之间地交流。

对于企业来说,即时通讯软件有助于企业内部沟通交流,加强了企业管理地控制 权。同时本软件是基于 Web 技术的,开发成本低,能为企业节省开销。企业在通讯 交流时,十分重视安全隐私问题,企业内在使用本软件时可以讲起部署在公司内部, 而且避免第三方拦截信息,从而实现企业的高质量通讯。

对于学生来说,即时通讯软件改变了传统的学习模式,当老师不在身边时,仍然 可以通讯软件向老师询问问题,使其主动利用即时通讯软件来进行学习交流和信息 共享。

当下处于疫情期间,广大社区群众之间可以通过即时通讯软件来进行沟通交流, 而社区委员会则可以通过此软件来对社区防疫人员进行一个系统管理,通过即时通 讯来实时关注防疫人员的各种情况,对于疫情防控也是能起到一定作用。

# 结 论

<span id="page-32-0"></span>本软件基于 WebSocket 协议实现了一个即时通讯系统,涵盖实时聊天的基本功 能。本软件功能由以下模块实现:登录模块实现了用户账号的注册与登录,好友模 块实现了用户之间相互添加好友等操作。针对以往常规的即时通讯不够便捷的问题, 本软件采用了 HTML5 中 WebSocket 协议来代替原有的 HTTP 长轮询,不仅实现了全双 工通信,而且只需要建立一次连接,就可以不断传输信息。同时在系统架构上,采 用了 B/S 架构,使得用户不必下载客户端,只需要在网站注册一个账号就可以很便 捷地开始即时通讯交流,系统的更新和维护也变得简单。在实现基本功能后,对系 统进行了测试,从用户、好友、消息等多个模块入手,分别进行功能测试。测试结 果显示各项功能基本正常符合需求。

本软件是一个功能完善的轻量级即时通讯系统,其应用场景包括:可以用在学校 教师于学生的沟通上,课外时间老师可借由本即时通讯软件与学生进行指导交流, 辅导功课;也可以用于企业中领导与员工之间的通讯沟通,通过本系统下发任务, 指派工作等等。

由于软件开发的局促性,系统仍然存在一定的漏洞或不足,后续应该加以改进。 同时软件也可以进一步的拓展,使用 WebRTC 技术来实现视频通讯功能,改进 WebSocket 协议的心跳检测等等。

### 致 谢

时光荏苒,大学的四年校园生活就要结束了,再过不久,我也将离开首义,去往 人生的下一个路口。四年,带走的还有我的青春最美好的时光,而回忆则成为了它 留给我最珍贵的宝物。

首先感谢我的导师对我的指导与帮助,在选题和相关技术问题上的解答,在后续 的论文批注上也不时指出我撰写的不规范之处。感谢我的母校,给我大学四年最快 乐的时光,也感谢大学以来的各位老师,大学四年来的悉心教导。

感谢我的室友们,同学们,谢谢大家一直以来的陪伴。也感谢我的朋友们,在实 习的那段时光是我很自在的日子,每天大家一起写代码,一起吃饭,一起聚会,真 的很开心。

感谢我的父母,二十多年来对我无微不至的关怀和支持,在我失落时也会给我打 来电话关心我的身体。不求荣华富贵,但求父母身体健康。

寒窗苦读十余载,功成名就尽风流。感谢自己,坚持到现在,在每一次人生路口 的选择上,做出了一个又一个选择,无论对错,只希望以后的路,自己可以好好走 下去。

最后,祝诸君万事如意,平安喜乐。

# 参考文献

- [1] 宋希香.第三代基于Java的校园即时通讯工具的设计与实现[J].科技视 界.2020,312(18):133-135.
- [2] 崔新科.计算机电子信息技术在即时通讯中的应用[J].信息与电脑(理论 版).2020,454(12):182-184.
- [3] 叶为正,林声肯,黄立轩等.即时通讯系统的设计与实现[J].计算机技术与发 展.2020,274(02):216-220.
- [4] 张烜,秦庆鹏.基于Java编程语言的内网即时通讯插件系统设计与实现[J].中 国新通信.2020,22(13):38-39.
- [5] Yuan Yang and Jingbo Han and Xu Zhang.The Development of Enterprise Instant Messaging System based on Android[J] . International Core Journal of Engineering.2021,7(11).
- [6] 杨熙乾.计算机电子信息技术在即时通讯上的应用[J].数字技术与应 用.2018,36(9):15-16,18.
- [7] 梁艳.基于HTML5的WebRTC技术浅析[J].信息通信技术.2014,(02):52-56.
- [8] 吴晓东,王鹏.HTML5的通信机制及效率的研究[J].长春理工大学学报.2011, 34(4):159.
- [9] 肖在昌,杨文晖,刘兵.基于WebSocket的实时技术[J].网络与通信.2012, (12):11.
- [10] 温照松,易仁伟,姚寒冰.基于WebSocket的实时Web应用解决方案[J].电脑知 识与技术.2012,(6):3826.
- [11] 张源伟,胡越,雷军.基于PHP的网页即时聊天系统的设计与实现[J].物联网技 术.2015,5(10):40-41.
- [12] 张艺.基于WebSocket的即时通信系统研究与实现[J].软件.2015,36(3): 89-94.
- [13] Pimentel V, Nickerson B.G.Communicating and Displaying Real-Time Date with Web-Socket[J]. IEEE Computer Society.2012,(4):45.

- [14] 李锐.浅谈即时通讯工具现状及其发展趋势[J].中国科技信息.2013,(16): 86.
- [15] 李光明.应用SOCKET实现网络通信[J].煤炭技术.2012,(3):88-90.
- [16] 谌颃.一种多功能网络即时通讯系统的设计[J].网络安全技术与应用.2014, (11):62,65.